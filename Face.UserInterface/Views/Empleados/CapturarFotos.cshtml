@model Face.EntidadesDeNegocio.Empleados
@{
    ViewData["Title"] = "Capturar Fotos";
}
<h2>Capturar Fotos para @Model.Nombre</h2>
<video id="video" width="320" height="240" autoplay></video>
<button id="capture">Capturar</button>
<canvas id="canvas" width="320" height="240" style="display: none;"></canvas>
<div class="row mt-3">
    <div class="col-md-4">
        <h4>Foto 1</h4>
        <img id="photo1" width="320" height="240" src="#" alt="Foto 1" />
    </div>
    <div class="col-md-4">
        <h4>Foto 2</h4>
        <img id="photo2" width="320" height="240" src="#" alt="Foto 2" />
    </div>
    <div class="col-md-4">
        <h4>Foto 3</h4>
        <img id="photo3" width="320" height="240" src="#" alt="Foto 3" />
    </div>
</div>
<form asp-action="GuardarFotos" method="post" id="photoForm">
    <input type="hidden" id="empleadoId" name="empleadoId" value="@Model.Id" />
    <input type="hidden" id="image1" name="image1" />
    <input type="hidden" id="image2" name="image2" />
    <input type="hidden" id="image3" name="image3" />
    <button type="submit" class="btn btn-success mt-3" id="savePhotos">Guardar Fotos</button>
</form>
@section Scripts {
    <script>
        var video = document.getElementById('video');
        var canvas = document.getElementById('canvas');
        var context = canvas.getContext('2d');
        var imageCount = 1;

        navigator.mediaDevices.getUserMedia({ video: true })
            .then(function (stream) {
                video.srcObject = stream;
            })
            .catch(function (err) {
                console.log("Error: " + err);
            });

        document.getElementById('capture').addEventListener('click', function () {
            context.drawImage(video, 0, 0, 320, 240);
            var data = canvas.toDataURL('image/png');

            if (imageCount == 1) {
                document.getElementById('image1').value = data;
                document.getElementById('photo1').setAttribute('src', data);
            } else if (imageCount == 2) {
                document.getElementById('image2').value = data;
                document.getElementById('photo2').setAttribute('src', data);
            } else if (imageCount == 3) {
                document.getElementById('image3').value = data;
                document.getElementById('photo3').setAttribute('src', data);
            }
            imageCount++;
            if (imageCount > 3) {
                imageCount = 1;
            }
        });
        document.getElementById('photoForm').addEventListener('submit', function (e) {
            if (!document.getElementById('image1').value || !document.getElementById('image2').value || !document.getElementById('image3').value) {
                alert('Debe capturar las tres fotos antes de guardar.');
                e.preventDefault();
            }
        });
    </script>
}
